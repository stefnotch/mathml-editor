var q=Object.defineProperty;var U=(t,e,n)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var b=(t,e,n)=>(U(t,typeof e!="symbol"?e+"":e,n),n);import{d as O,r as X,o as W,w as z,a as S,c as F,b as C,F as K,e as V}from"./vendor.bd981c14.js";const Y=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}};Y();function d(t,e){if(!t)throw new Error(e)}function P(t){throw new Error("This case should have never been reached")}var H={getBinaryInsertIndex:function(t,e){let n=0,r=t.length-1;for(;n<=r;){let o=n+Math.floor((r-n)/2),l=e(t[o]);if(l<0)n=o+1;else if(l>0)r=o-1;else return{index:o,itemExists:!0}}return{index:n,itemExists:!1}},at:function(t,e){let n=Math.trunc(e)||0;if(n<0&&(n+=t.length),!(n<0||n>=t.length))return t[n]},get:function(t,e){let n=Math.trunc(e)||0;if(!(n<0||n>=t.length))return t[n]},remove:function(t,e){const n=t.indexOf(e);return n>=0?(t.splice(n,1),!0):!1}};function G(t){const e={mathIR:t,parents:new Map,getParent:n,getParentAndIndex:r,setChild:i,removeChild:o,insertChild:l,setParents:a};function n(s){const f=e.parents.get(s);return f||null}function r(s){const f=e.parents.get(s);if(!f)return{parent:null,indexInParent:-1};if(f.type=="row"){d(s.type!="row");const c=f.values.indexOf(s);return d(c>=0),{parent:f,indexInParent:c}}else if(f.type=="table"){d(s.type=="row");const c=f.values.length,g=f.values[0].length;for(let E=0;E<c;E++){const D=f.values[E].indexOf(s);if(D==-1)continue;const $=E*g+D;return{parent:f,indexInParent:$}}throw new Error("Element not found in table")}else{d(s.type=="row");const c=f.values.indexOf(s);return d(c>=0),{parent:f,indexInParent:c}}}function o(s,f){d(s.type=="row"),H.remove(s.values,f),e.parents.delete(f)}function l(s,f,c){d(s.type=="row"),s.values.splice(c,0,f),e.parents.set(f,s)}function i(s,f,c,g){if(s.type=="row")d(c!==void 0),d(f.type!="row"),s.values[c]=f,e.parents.set(f,s);else if(s.type=="frac"||s.type=="root"||s.type=="under"||s.type=="over"||s.type=="sup"||s.type=="sub")d(c!==void 0),d(f.type=="row"),s.values[c]=f,e.parents.set(f,s);else{if(s.type=="bracket"||s.type=="symbol"||s.type=="text"||s.type=="error")throw new Error("Illegal call to setChild");s.type=="table"?(d(c!==void 0),d(g!==void 0),d(f.type=="row"),s.values[c][g]=f,e.parents.set(f,s)):P()}}function a(s,f){for(let c=0;c<f.length;c++){e.parents.set(f[c],s);const g=u(f[c]);g!=null&&a(g,p(f[c]))}}function u(s){return s.type=="row"||s.type=="frac"||s.type=="root"||s.type=="under"||s.type=="over"||s.type=="sup"||s.type=="sub"||s.type=="table"?s:null}function p(s){return s.type=="row"||s.type=="frac"||s.type=="root"||s.type=="under"||s.type=="over"||s.type=="sup"||s.type=="sub"?s.values:s.type=="table"?s.values.flatMap(f=>f):[]}return a(null,[t]),e}const k=[["(",")"],["[","]"],["{","}"],["\u2308","\u2309"],["\u230A","\u230B"],["\u2329","\u232A"],["\u2772","\u2773"],["\u27E6","\u27E7"],["\u27E8","\u27E9"],["\u27EA","\u27EB"],["\u27EC","\u27ED"],["\u27EE","\u27EF"],["\u2983","\u2984"],["\u2985","\u2986"],["\u2987","\u2988"],["\u2989","\u298A"],["\u298B","\u298C"],["\u298D","\u298E"],["\u298F","\u2990"],["\u2991","\u2992"],["\u2993","\u2994"],["\u2995","\u2996"],["\u2997","\u2998"],["\u29D8","\u29D9"],["\u29DA","\u29DB"],["\u29FC","\u29FD"]],J=[["|","|"],["\u2016","\u2016"],["\u2980","\u2980"],["\u2999","\u2999"]],B=new Map(k),M=new Map(k.map(([t,e])=>[e,t])),L=new Set([...k.flat(),...J.flat()]);function w(t){if(!Array.isArray(t)){if(t.type=="row")return t;t=[t]}return{type:"row",values:t.flatMap(e=>e.type=="row"?e.values:e)}}function Q(t,e){const n=t[e];d(n.type=="bracket");let r=0;for(let o=e+1;o<t.length;o++){const l=t[o];if(l.type=="bracket"){if(B.has(l.value))r+=1;else if(M.has(l.value))if(r>0)r-=1;else return o}}return null}function Z(t,e){const n=t[e];d(n.type=="bracket");let r=0;for(let o=e+1;o<t.length;o++){const l=t[o];if(l.type=="bracket"){if(r<=0&&l.value==n.value)return o;B.has(l.value)?r+=1:M.has(l.value)&&r>0&&(r-=1)}}return null}function x(t,e){return t.children.length!=e?{type:"error",value:`Expected ${e} children in ${t.tagName.toLowerCase()}`}:null}function j(t){d(v(t,"math"));const e=h(t);return d(!Array.isArray(e)),d(e.type=="row"),e}function I(t){const e=new Map,n=y("math",[]),r=m(t,e);return v(r,"mrow")?n.append(...r.childNodes):n.append(r),{element:n,mathIRLayout:e}}const R="http://www.w3.org/1998/Math/MathML";function y(t,e){let n=document.createElementNS(R,t);return e.forEach(r=>{n.appendChild(r)}),n}function T(t){return(t.textContent+"").trim()}function h(t){var n,r,o,l,i,a,u,p;let e=[...t.children];if(v(t,"math","mrow","mtd"))return w(e.flatMap(s=>h(s)));if(v(t,"semantics")&&e.length>0)return h(e[0]);if(v(t,"mtext","ms"))return{type:"text",value:T(t)};if(v(t,"mi","mn"))return T(t).split("").map(s=>({type:"symbol",value:s}));if(v(t,"mo"))return T(t).split("").map(s=>t.getAttribute("stretchy")!="false"&&L.has(s)?{type:"bracket",value:s}:{type:"symbol",value:s});if(v(t,"mfrac"))return(n=x(t,2))!=null?n:{type:"frac",values:e.map(s=>w(h(s)))};if(v(t,"msqrt"))return{type:"root",values:[w({type:"symbol",value:"2"}),w(e.flatMap(s=>h(s)))]};if(v(t,"mroot"))return(r=x(t,2))!=null?r:{type:"root",values:[w(h(e[1])),w(h(e[0]))]};if(v(t,"msub")){let s=h(e[0]);return Array.isArray(s)||(s=[s]),(o=x(t,2))!=null?o:[...s,{type:"sub",values:[w(h(e[1]))]}]}else if(v(t,"msup")){let s=h(e[0]);return Array.isArray(s)||(s=[s]),(l=x(t,2))!=null?l:[...s,{type:"sup",values:[w(h(e[1]))]}]}else if(v(t,"msubsup")){let s=h(e[0]);return Array.isArray(s)||(s=[s]),(i=x(t,3))!=null?i:[...s,{type:"sub",values:[w(h(e[1]))]},{type:"sup",values:[w(h(e[2]))]}]}else return v(t,"munder")?(a=x(t,2))!=null?a:{type:"under",values:[w(h(e[0])),w(h(e[1]))]}:v(t,"mover")?(u=x(t,2))!=null?u:{type:"over",values:[w(h(e[0])),w(h(e[1]))]}:v(t,"munderover")?(p=x(t,3))!=null?p:{type:"over",values:[w({type:"under",values:[w(h(e[0])),w(h(e[1]))]}),w(h(e[2]))]}:v(t,"mtable")?e.every(s=>v(s,"mtr")&&[...s.children].every(f=>v(f,"mtd")))?{type:"table",values:e.map(s=>[...s.children].map(f=>w(h(f))))}:{type:"error",value:"Unexpected children "+t}:{type:"error",value:"Unknown element "+t}}function v(t,...e){return e.includes(t.tagName.toLowerCase())}function N(t,e){const n=document.createRange();return n.setStart(t,e),t.length>0&&n.setEnd(t,e+1),n.getBoundingClientRect()}function ee(t,e){const n=e>=t.length,r=n?N(t,Math.max(0,t.length-1)):N(t,e);return{x:r.x+(n?r.width:0)+window.scrollX,y:r.y+window.scrollY,height:r.height}}function te(t,e){console.log("getRowLayout",e),d(e<=t.length);const n=t[e]();return{x:n.x+window.scrollX,y:n.y+window.scrollY,height:n.height}}function m(t,e){function n(o,l){return e==null||e.set(o,i=>ee(l,i)),l}function r(o,l){e==null||e.set(o,i=>te(l,i))}if(t.type=="error")return y("merror",[y("mtext",[n(t,document.createTextNode(t.value))])]);if(t.type=="frac")return y("mfrac",[m(t.values[0],e),m(t.values[1],e)]);if(t.type=="over")return y("mover",[m(t.values[0],e),m(t.values[1],e)]);if(t.type=="under")return y("munder",[m(t.values[0],e),m(t.values[1],e)]);if(t.type=="root")return y("mroot",[m(t.values[1],e),m(t.values[0],e)]);if(t.type=="row"){const o=_(t.values,e);return r(t,o.mathLayout),y("mrow",o.elements)}else{if(t.type=="sub"||t.type=="sup")return y("merror",[y("mtext",[document.createTextNode("Unexpected "+t.type)])]);if(t.type=="symbol"){const o=_([t],e);return o.elements.length==1?o.elements[0]:y("mrow",o.elements)}else if(t.type=="bracket"){const o=y("mo",[document.createTextNode(t.value)]);return o.setAttribute("stretchy","false"),o}else{if(t.type=="text")return y("mtext",[n(t,document.createTextNode(t.value))]);if(t.type=="table")return y("mtable",t.values.map(o=>y("mtr",o.map(l=>l.type=="row"?y("mtd",[m(l,e)]):y("mtd",[m(l,e)])))));P()}}}const ne=/^\p{Nd}+$/gu,se=/^\p{Nd}+(\.\p{Nd}*)?$/gu;function _(t,e){const n=[],r=[];function o(l){n.push(l),r.push(()=>l.getBoundingClientRect())}for(let l=0;l<t.length;l++){const i=t[l];if(i.type=="symbol")if(i.value.search(ne)!=-1){const a=re(t,l);n.push(a.element),r.push(...a.mathLayout),l=a.lastDigitIndex}else if(L.has(i.value)){const a=y("mo",[document.createTextNode(i.value)]);a.setAttribute("stretchy","false"),o(a)}else o(y("mi",[document.createTextNode(i.value)]));else if(i.type=="bracket")if(M.has(i.value))o(m(i,e));else{const a=B.has(i.value)?Q(t,l):Z(t,l);if(a==null)o(m(i,e));else{const u=_(t.slice(l+1,a),e),p=t[a];d(p.type=="bracket");const s=y("mo",[document.createTextNode(i.value)]),f=y("mo",[document.createTextNode(p.value)]);n.push(y("mrow",[s,u.elements.length==1?u.elements[0]:y("mrow",u.elements),f])),r.push(()=>s.getBoundingClientRect()),r.push(...u.mathLayout),r.push(()=>f.getBoundingClientRect())}}else if(i.type=="sub"||i.type=="sup"){const a=n.pop();if(a){const u=m(i.values[0],e);r.push(()=>{const p=a.getBoundingClientRect();return p.x+=p.width,p.width=u.getBoundingClientRect().width,p}),n.push(y(i.type=="sub"?"msub":"msup",[a,u]))}else o(m(i,e))}else o(m(i,e))}if(r.length>0){const l=r[r.length-1];r.push(()=>{const i=l();return i.x+=i.width,i.width=0,i})}else{const l=y("mtext",[document.createTextNode("\u2B1A")]);n.push(l),r.push(()=>{const i=l.getBoundingClientRect();return i.x+=i.width/2,i.width=0,i})}return{elements:n,mathLayout:r}}function re(t,e){const n=[],r=t[e];d(r.type=="symbol");let o=r.value,l=e+1,i=1;for(;l<t.length;){const u=t[l];if(u.type=="symbol"&&(o+u.value).search(se)!=-1)o+=u.value,l+=1,i+=1;else break}const a=document.createTextNode(o);for(let u=0;u<i;u++)n.push(()=>N(a,u));return{element:y("mn",[a]),mathLayout:n,lastDigitIndex:l-1}}function oe(t){const e=document.createElement("span");e.style.userSelect="none",e.style.position="absolute",e.style.height="10px",e.style.width="0px",e.style.margin="0px",e.style.borderRightWidth="0px",e.style.boxShadow="0px 0px 0px 0.6px rgba(50, 50, 230, 50%)",e.style.top="0px",e.className="math-cursor",t.appendChild(e);function n(l,i){e.style.left=`${l}px`,e.style.top=`${i}px`}function r(l){e.style.height=`${l}px`}function o(){t.removeChild(e)}return{setPosition:n,setHeight:r,destroy:o}}function le(t){const e=document.createElement("textarea");e.autocomplete="off",e.spellcheck=!1,e.setAttribute("autocorrect","off"),e.style.transform="scale(0)",e.style.resize="none",e.style.position="absolute",e.style.clipPath="polygon(0 0)",e.style.width="0px",e.style.height="0px",e.className="math-input-area",t.appendChild(e);function n(){t.removeChild(e)}return{inputElement:e,destroy:n}}function ue(t,e,n){if(d(n!=0),t.type=="row")if(e.type!="row"){const r=t.values.indexOf(e);return d(r!=-1),r+n>=t.values.length||r+n<0?null:t.values[r+n]}else return null;else if(t.type=="table")if(e.type=="row"){const r=t.values.length,o=t.values[0].length;for(let l=0;l<r;l++){const i=t.values[l].indexOf(e);if(i==-1)continue;const u=l*o+i+n;return u>=r*o||u<0?null:t.values[Math.trunc(u/o)][u%o]}throw new Error("Element not found in table")}else return null;else if(e.type=="row"){const r=t.values.indexOf(e);return d(r!=-1),r+n>=t.values.length||r+n<0?null:t.values[r+n]}else return null}class ie{constructor(e){b(this,"carets",new Set);b(this,"mathAst");b(this,"render");b(this,"lastLayout",null);b(this,"inputHandler");e.style.userSelect="none",e.style.display="block",e.style.fontFamily="STIX Two",e.tabIndex=0,this.mathAst=G(j(e)),console.log(this.mathAst),this.carets.add({row:this.mathAst.mathIR,offset:0,caretElement:oe(document.body)}),this.inputHandler=le(document.body),e.addEventListener("focus",n=>{this.inputHandler.inputElement.focus()}),this.inputHandler.inputElement.addEventListener("keydown",n=>{console.info(n),n.key=="ArrowUp"?(this.carets.forEach(r=>this.moveCaret(r,"up")),this.renderCarets()):n.key=="ArrowDown"?(this.carets.forEach(r=>this.moveCaret(r,"down")),this.renderCarets()):n.key=="ArrowLeft"?(this.carets.forEach(r=>this.moveCaret(r,"left")),this.renderCarets()):n.key=="ArrowRight"&&(this.carets.forEach(r=>this.moveCaret(r,"right")),this.renderCarets())}),this.inputHandler.inputElement.addEventListener("beforeinput",n=>{if(console.info(n),n.inputType=="deleteContentBackward"||n.inputType=="deleteWordBackward")this.carets.forEach(r=>this.deleteAtCaret(r,"left")),this.render();else if(n.inputType=="deleteContentForward"||n.inputType=="deleteWordForward")this.carets.forEach(r=>this.deleteAtCaret(r,"right")),this.render();else if(n.inputType=="insertText"){const r=n.data;r!=null&&this.carets.forEach(o=>this.insertAtCaret(o,r)),this.render()}}),window.addEventListener("resize",()=>this.renderCarets()),this.render=()=>{const n=I(this.mathAst.mathIR);this.lastLayout=n.mathIRLayout,e.replaceChildren(...n.element.children),this.renderCarets()},this.render()}renderCarets(){this.carets.forEach(e=>this.renderCaret(e))}renderCaret(e){const n=this.lastLayout;if(!n)return;const r=n.get(e.row);d(r!==void 0);const o=r(e.offset);e.caretElement.setPosition(o.x,o.y),e.caretElement.setHeight(o.height)}removeCaret(e){e.caretElement.destroy(),this.carets.delete(e)}moveCaret(e,n){const r=this.mathAst;function o(u,p){const s=p=="left",f=r.parents.get(u);if(!f)return!1;if(f.type=="row"){const c=f.values.indexOf(u);return d(c!=-1),e.row=f,e.offset=c+(s?0:1),!0}else{const c=ue(f,u,s?-1:1);return c!=null?(e.row=c,e.offset=s?c.values.length:0,!0):o(f,p)}}function l(u){return u.type=="text"||u.type=="error"?(e.row=u,e.offset=0,!0):u.type=="bracket"||u.type=="symbol"?!1:u.type=="table"?(e.row=u.values[0][0],e.offset=0,!0):(e.row=u.values[0],e.offset=0,!0)}function i(u){if(u.type=="text"||u.type=="error")return e.row=u,e.offset=u.value.length,!0;if(u.type=="bracket"||u.type=="symbol")return!1;if(u.type=="table"){const p=u.values[u.values.length-1];return e.row=p[p.length-1],e.offset=0,!0}else{const p=u.values[u.values.length-1];return e.row=p,e.offset=p.values.length,!0}}function a(u,p){const{parent:s,indexInParent:f}=r.getParentAndIndex(u);if(!s||s.type=="table")return!1;if(s.type=="frac"||s.type=="root"||s.type=="under"||s.type=="over")if(u.type=="row"){const c=f+(p=="up"?-1:1);if(c<0||c>=s.values.length){const g=r.getParent(s);return g==null?!1:a(g,p)}else{const g=s.values[c];return e.row=s.values[c],e.offset=p=="up"?g.values.length:0,!0}}else return!1;else return s.type=="sup"||s.type=="sub"?!1:a(s,p)}n=="right"?this.isCaretAtEdge(e,n)?o(e.row,n):e.row.type=="row"&&l(e.row.values[e.offset])||(e.offset+=1):n=="left"?this.isCaretAtEdge(e,n)?o(e.row,n):e.row.type=="row"&&i(e.row.values[e.offset-1])||(e.offset-=1):n=="up"||n=="down"?a(e.row,n):P()}isCaretAtEdge(e,n){return n=="right"?e.row.type=="row"?e.offset>=e.row.values.length:e.offset>=e.row.value.length:e.offset<=0}getElementAtCaret(e,n){var r;if(e.row.type=="row"){const o=e.offset+(n=="left"?-1:0);return(r=H.get(e.row.values,o))!=null?r:null}else return null}deleteAtCaret(e,n){function r(o,l,i){const{parent:a,indexInParent:u}=o.getParentAndIndex(l);d(a!=null);for(let p=0;p<i.length;p++)o.insertChild(a,i[p],u+p);return o.removeChild(a,l),{parent:a,indexInParent:u}}if(e.row.type=="row"){const o=this.getElementAtCaret(e,n);if(o==null){const{parent:l,indexInParent:i}=this.mathAst.getParentAndIndex(e.row);if(l==null)return;if(l.type=="frac")if(i==0&&n=="left"||i==1&&n=="right")this.moveCaret(e,n);else{const a=l.values.flatMap(s=>s.values),{parent:u,indexInParent:p}=r(this.mathAst,l,a);e.row=u,e.offset=p+l.values[0].values.length}else if((l.type=="sup"||l.type=="sub")&&n=="left"){const a=l.values.flatMap(s=>s.values),{parent:u,indexInParent:p}=r(this.mathAst,l,a);e.row=u,e.offset=p}else if(l.type=="root")if(i==0&&n=="right"||i==1&&n=="left"){const a=l.values[1].values,{parent:u,indexInParent:p}=r(this.mathAst,l,a);e.row=u,e.offset=p}else this.moveCaret(e,n);else this.moveCaret(e,n)}else if(o.type=="symbol"||o.type=="bracket")this.mathAst.removeChild(e.row,o),n=="left"&&(e.offset-=1);else if((o.type=="sup"||o.type=="sub")&&n=="right"){const l=o.values.flatMap(u=>u.values),{parent:i,indexInParent:a}=r(this.mathAst,o,l);e.row=i,e.offset=a}else this.moveCaret(e,n)}else n=="left"&&e.offset<=0||n=="right"&&e.offset>=e.row.value.length?this.moveCaret(e,n):n=="left"?(e.row.value=e.row.value.slice(0,e.offset-1)+e.row.value.slice(e.offset),e.offset-=1):e.row.value=e.row.value.slice(0,e.offset)+e.row.value.slice(e.offset+1)}insertAtCaret(e,n){if(e.row.type=="row")if(n=="^"){const r={type:"sup",values:[{type:"row",values:[]}]};this.mathAst.setParents(null,[r]),this.mathAst.insertChild(e.row,r,e.offset),e.row=r.values[0],e.offset=0}else if(n=="_"){const r={type:"sub",values:[{type:"row",values:[]}]};this.mathAst.setParents(null,[r]),this.mathAst.insertChild(e.row,r,e.offset),e.row=r.values[0],e.offset=0}else n=="/"||n.length==1&&(this.mathAst.insertChild(e.row,{type:"symbol",value:n},e.offset),e.offset+=1);else e.row.value=e.row.value.slice(0,e.offset)+n+e.row.value.slice(e.offset),e.offset+=n.length}destroy(){[...this.carets].forEach(e=>this.removeCaret(e)),this.render=()=>{},this.lastLayout=null,this.inputHandler.destroy()}}const A=O({props:{mathml:String},setup(t){const e=t,n=X();return W(()=>{n.value&&(n.value.innerHTML=e.mathml+"")}),z(n,r=>{console.log(r),r&&new ie(r.firstElementChild)},{immediate:!0}),(r,o)=>(S(),F("span",{ref_key:"mathElement",ref:n},null,512))}});const fe=O({setup(t){return(e,n)=>(S(),F(K,null,[C(A,{mathml:`<math
        display='block'
        style='font-family: STIX Two'
      >
        <msqrt>
          <msqrt>
            <mi>x</mi>
            <mi>x</mi>
            <mi>x</mi>
          </msqrt>
          <mi>a</mi>
        </msqrt>
        <mfrac>
          <mi>b</mi>
          <mi>c</mi>
        </mfrac>
      </math>`}),C(A,{mathml:`<math>
    <mn>-1214.3001</mn>
    <mn>-1</mn>
    <mn>.3</mn>

    <mo>-</mo>
    <mn>1.3</mn>
  </math>`}),C(A,{mathml:`<math>
    <mfrac>
          <mn>1.22</mn>
          <mtext>henlo</mtext>
        </mfrac>
  </math>`}),C(A,{mathml:`<math>
    <mrow><mo>-</mo><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msup><mi>y</mi><mfrac><mn>2</mn><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></mfrac></msup></mrow>
  </math>`})],64))}});V(fe).mount("#app");
